# 实验报告：pintos修改testcase实验 
|   课程名称：操作系统实践 |    年级：2023级    |   上机实践成绩：  |
| :--------------------: | :-----------------: | :----------------: |
|   指导教师：张民  |   姓名：李彤  |       |
|   上机实践名称：pintos修改testcase实验     |   学号：10235101500   |   上机实践日期：2024.10.14  |
|   上机实践编号：  |   组号：  |   上机实践时间：  |

### 一、VsCode开发环境配置（可选做）
**非常非常巧！！** 昨天晚上我在使用Ubuntu的时候，刚好尝试了使用 **Remote-SSH** 将虚拟机连接到VsCode上
![Remote-SSH](./remote-ssh(2).png)
没想到今天上课就讲了这一部分内容，有了前一天的实操之后，今天的内容就熟悉多了，于是就自己照着课件配置了一下。
![Remote-Development](./remote-ssh.png)

#### 1. 运行docker
在运行docker之前，因为上次实验课开启了很多个容器，所以就想着把多余的容器都删除了，但是没想到剩下的容器没有还没有make ~~（可能是上节课在尝试docker run指令时随便开启的）~~ ，所以干脆又新开了一个容器并按照上节课的步骤重新配置。      
（下图中是删除其他容器之后重新启动了一个新的container的结果）
![重新开启容器](./pintos.png)

#### 2. 连接开发容器
下载好Remote Development后，按照下图中的顺序点击，vscode会自动匹配pintos所在本地目录，因此很快就连接好了，这里也没有什么问题。
![连接](./Dev.png)

### 二、修改、新增testcase
**注：因为后面有一些步骤比较简单，基本都照着课件做就行，所以就挑了一些我出现问题的地方讲一下**

#### 问题1：
> 在tests/threads_SRC += 后添加hello-world.c，告诉编译器源码在哪个文件里编译

在这里，因为我是直接将第一条语句cv下来再修改，等号前面少了一个 **+** 号，导致缺少了test.c的路径
![，](./+.png)

#### 问题2：
在这里，在将hello-world函数引入后，我忘记了在句末添加一个 **,**逗号
<img src="./2.png" width = 100%>

#### 报错：
由于前面的两个错误，在make的时候，不出意外的报错了。。。
![error](./error.png)

#### 解决：
一开始，我并没有怀疑自己写的代码有问题=￣ω￣=，所以直接去网上寻找解决方法。
![solution](./solution.png)
按照文章推荐，我先后输入了make clean 和 make指令 ~~（问题依旧没有解决）~~     
BUT！！！我注意到了文章的最后一行**编码空格等导致的问题**，这让我想到可能是自己在写代码的时候存在一些语法或格式问题，于是我开始检查自己的代码，果然让我找到了这两个错误o(*￣▽￣*)ブ，遂改之！

### 三、运行和测试hello-world
因为后面的步骤没有出现什么问题，所以只展示一些命令运行的结果
#### 1. pintos -- -q run hello-world
<img src="./pintos--runhelloworld.png" width = 40%>

#### 2. make check
![make-check](./make-check.png)

### 心得体会
* 在写代码的时候，即使是再小的错误也可能会让你的程序直接崩溃，而检查代码的过程往往又是困难的，这可能需要我们花上几个甚至数十个小时的时间（当然因为这次的实践课比较简单，检查代码也没有花费太长时间），与其到最后痛苦的找错，不如一开始就认认真真写好，避免这种错误。
* 通过开发容器或者Remote-SSH将vscode和虚拟机连接在一起确实很方便，在vscode上面编辑文本或者代码比在虚拟机上面更快更便捷，还可以安装各种拓展包。并且以后我就可以根据通过打开docker和vscode来使用pintos了，而不需要再通过命令行来操作了（避免又创建很多个容器）。

## 补充：
**注：**
因为课上就把实验做完了，所以干脆就把实验报告写了一并交上去。但是！！！没看到作业有把代码提交到github/gitee上的要求（虽然是可选的，但我还是想做一下，所以今天来补做了）。然后，drama的事情就发生了，

**出现的问题：**
当我再次运行docker和vscode的时候，在最后的make竟然报错了！！！（这里当时没有截图所以只能口头说明一下情况）大概就是说makefile在调试文件的时候出现了问题（现在想想应该是格式问题之类的）
当时也尝试了很久一直都没有修复好，最后选择了一个最笨的方法——重新做一遍实验（其实也还好，因为之前的实验都完全笑话了，所以再从头来的话很快就搞好了），并且在vscode终端make、run、make check都没有问题（跳过）

**git提交代码**
* 首先我是把pintos原仓库fork了一份到自己仓库，然后准备使用git指令将修改好的pintos文件传到自己的仓库里（很丑陋的过程，但至少结果是好的，之后还是会继续学习git的使用的）
* 在我使用**git add .**指令想将仓库的更改提交到暂存区时，终端给我报了两个ERROR
![error](./lf2cr.png)
没错！就是这个地方我终于知道为什么之前能运行的程序当我再次打开后却会报错了，就是因为 **Windows上的编辑器会悄悄把行尾的换行（LF）字符转换成回车（CR）和换行（LF），或在用户按下 Enter 键时，插入回车（CR）和换行（LF）两个字符。**
* 了解到出错的原因后，我就去网上寻求解决方法了，如下：
![solution](./solve.png)
* 后面就正常完成git commit、git push指令即可。

### 仓库地址 https://github.com/psycho0816/pintos.git